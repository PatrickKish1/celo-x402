X402

# Welcome to x402

## Overview

x402 is a new open payment protocol developed by Coinbase that enables instant, automatic stablecoin payments directly over HTTP.

By reviving the [HTTP 402 Payment Required](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status/402) status code, x402 lets services monetize APIs and digital content onchain, allowing clients, both human and machine, to programmatically pay for access without accounts, sessions, or complex authentication.

## Who is x402 for?

* **Sellers:** Service providers who want to monetize their APIs or content. x402 enables direct, programmatic payments from clients with minimal setup.
* **Buyers:** Human developers and AI agents seeking to access paid services without accounts or manual payment flows.

Both sellers and buyers interact directly through HTTP requests, with payment handled transparently through the protocol.

## Use cases

x402 enables a range of use cases, including:

* API services paid per request
* AI agents that autonomously pay for API access
* Paywalls for digital content
* Microservices and tooling monetized via microtransactions
* Proxy services that aggregate and resell API capabilities

## How it works

x402 uses a simple request-response flow with programmatic payments. For a detailed explanation, see [How x402 Works](/x402/core-concepts/how-it-works).

At a high level:

1. The buyer requests a resource from the server (e.g. an API call, see [client/server roles](/x402/core-concepts/client-server))
2. If payment is required, the server responds with a [402 Payment Required](/x402/core-concepts/http-402), including payment instructions
3. The buyer constructs and sends a payment payload
4. The server verifies and settles the payment via the [facilitator](/x402/core-concepts/facilitator). If valid, the server returns the requested resource

## Beyond legacy limitations

x402 is designed for a modern internet economy, solving key limitations of legacy systems:

* **Reduce fees and friction:** Direct onchain payments without intermediaries, high fees, or manual setup.
* **Micropayments & usage-based billing:** Charge per call or feature with simple, programmable pay-as-you-go flows.
* **Machine-to-machine transactions:** Let AI agents pay and access services autonomously with no keys or human input needed.

## Offload your infra

The x402 [Facilitator](/x402/core-concepts/facilitator) handles payment verification and settlement so that sellers don't need to maintain their own blockchain infrastructure.

The Coinbase Developer Platform (CDP) offers a Coinbase-hosted facilitator service that processes fee-free USDC payments on the Base network, offering a streamlined and predictable experience for both buyers and sellers.

Facilitators handle verification and settlement, so sellers do not need to maintain blockchain infrastructure.

CDP's x402 facilitator provides:

* Fee-free USDC payments on the Base network
* Fast, onchain settlement of transactions
* Simplified setup for sellers to start accepting payments

## Facilitator roadmap

CDP's x402 facilitator is designed as a facilitator on top of an open standard, which is not tied to any single provider. Over time, the facilitator will include:

* A discovery layer for buyers (human and agents) to find available services
* Support for additional payment flows (e.g., pay for work done, credit based billing, etc.)
* Optional attestations for sellers to enforce KYC or geographic restrictions
* Support for additional assets and networks

The goal is to make programmatic commerce accessible, permissionless, and developer-friendly.

## What to read next

* [Quickstart for Sellers](/x402/quickstart-for-sellers): Get started with x402 by accepting payments from clients.
* [Quickstart for Buyers](/x402/quickstart-for-buyers): Get started with x402 by paying for services.
* [Network Support](/x402/network-support): See available facilitators and supported networks.
* [How x402 Works](/x402/core-concepts/how-it-works): Understand the complete payment flow.
* [Join our community on Discord](https://discord.gg/invite/cdp): Get help and stay up to date with the latest developments.




# x402 Hackathon Guide

**Ready to build the future of programmatic payments and agentic commerce?**

This guide covers how to quickly get started building with x402, an open payment protocol that enables instant, automatic stablecoin payments directly over HTTP. We'll show you how to monetize APIs, enable AI agents to pay for services, and create frictionless payment experiences.

### x402 Overview

x402 is a new open payment protocol developed by Coinbase that revives the [HTTP 402 Payment Required](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status/402) status code to enable instant, programmatic stablecoin payments. Think of it as bringing native payments to the internet - no accounts, no API keys, just pay and access.

**Key capabilities:**

* **Instant Micropayments**: Pay-per-request APIs with USDC on Base (fee-free!)
* **Agent-Native Payments**: AI agents can autonomously discover and pay for services
* **No Authentication Required**: No API keys, accounts, or complex auth flows
* **Simple Integration**: Add payments to any HTTP endpoint with minimal code
* **ðŸ†• Discovery Layer (x402 Bazaar)**: Agents can find and use services programmatically - [learn more](/x402/bazaar)

## Getting Started

### Quick Start Options

1. **For Sellers (Monetize Your API)**
   * Follow our [Quickstart for Sellers](/x402/quickstart-for-sellers) to add x402 payments to your API
   * Check out the [express server example](https://github.com/coinbase/x402/tree/main/examples/typescript/servers/express) for a complete implementation
   * Use our middleware for popular frameworks (Express, Next.js, FastAPI, Flask, etc.)

2. **For Buyers (Build Payment-Enabled Agents)**
   * Start with the [Quickstart for Buyers](/x402/quickstart-for-buyers)
   * Use the [x402-axios client](https://github.com/coinbase/x402/tree/main/packages/typescript/x402-axios) for automatic payment handling
   * Integrate with [AgentKit](/agentkit/docs/welcome) for powerful AI agent capabilities

3. **MCP Server Integration**
   * Build Model Context Protocol servers that can pay for services
   * See our [MCP Server guide](/x402/mcp-server) for Claude Desktop integration
   * Check the [MCP example](https://github.com/coinbase/x402/tree/main/examples/typescript/mcp) in our repo

4. **Discover Services with x402 Bazaar**
   * Use the new [x402 Bazaar](/x402/bazaar) to programmatically discover available x402 services
   * Perfect for building agents that can autonomously find and use new capabilities
   * No need to hardcode endpoints - let your agents discover services dynamically!

5. **Miniapps with Payments**
   * Use our [Farcaster miniapp template](https://github.com/coinbase/x402/tree/main/examples/typescript/fullstack/farcaster-miniapp)
   * See the [Miniapps guide](/x402/miniapps) for building payment-enabled experiences in TBA

### Development Tools

* **GitHub Repository**: [github.com/coinbase/x402](https://github.com/coinbase/x402)
* **Network Support**: Currently supporting USDC on Base (mainnet) and Base Sepolia (testnet). To use x402 on mainnet, you'll need to use the [CDP facilitator](/x402/core-concepts/facilitator)
* **Discord Support**: Join us in the [CDP Discord](https://discord.com/invite/cdp/)

### Integration with CDP Products

x402 works seamlessly with other Coinbase Developer Platform products:

* **[CDP Wallets](/server-wallets/comparing-our-wallets)**: Use Server Wallets for agent payments or Embedded Wallets for user-facing apps
* **[AgentKit](/agentkit/docs/welcome)**: Create AI agents that can autonomously pay for services
* **[Onramp](/onramp/docs/welcome)**: Enable users to fund their wallets to pay for x402 services

## Project Ideas

### AI Agent Projects

**Financially Autonomous Agent**
Build an agent that becomes truly financially independent. Give it the ability to:

* Access the [x402 Bazaar](/x402/bazaar) to dynamically discover and use new services
* Post on social platforms to build its reputation
* Create and post bounties for tasks it needs completed
* Self-improve by purchasing new tools and capabilities via x402
* Bonus: Allow the agent to restart itself with expanded capabilities learned from the Bazaar

**Self-Improving Agent**
Create an agent that progressively enhances itself:

* Starts with basic capabilities
* Discovers new tools available via the [x402 Bazaar](/x402/bazaar)
* Purchases and integrates new tools autonomously
* Builds its own website showcasing learned capabilities
* Restarts with more tools and improved functionality from the Bazaar ecosystem

**Hybrid Intelligence Agent**
Build an agent that intelligently manages compute resources:

* Uses a local model for routine decisions
* Automatically outsources to Hyperbolic's x402 API for complex reasoning
* Optimizes cost vs. performance dynamically
* Tracks spending and adjusts strategy based on results

**AI Code Review Agent**
Deploy a Claude Code instance (or similar) as a service:

* Accessible via x402 for a set price per review
* Performs code reviews, bug fixes, or PR analysis
* No subscription or API key required - pure pay-per-use
* Could integrate with GitHub webhooks for automatic reviews

**Bounty-Posting Agent**
Create an agent that acts as a project manager:

* Posts bounties for various tasks using x402 payments
* Verifies completed work and releases payments
* Learns from completed tasks to post better bounties
* Could manage entire projects autonomously

### Infrastructure & Tools

**Endpoint Wrapping**
Take existing APIs and make them x402-compatible:

* Wrap non-x402 endpoints to enable pay-per-use access
* Priority targets:
  * Browser/Computer Use APIs
  * GPU Compute services
  * Data storage/retrieval endpoints
  * LLM inference APIs
* Create a marketplace of wrapped endpoints
* Note: Some of these services already exist ([https://mcpay.fun](https://mcpay.fun) , [https://www.monetizedmcp.org/](https://www.monetizedmcp.org/)), and you can use them to build wrapped endpoints.

**Payment Splitting System**
Develop mechanisms for sharing x402 payments:

* Split payments between creators and publishers
* Revenue sharing for agent-tool ecosystems
* Integration with @0xSplits or similar protocols
* Transparent, onchain payment distribution

**Swarm Task Router**
Build a decentralized task marketplace:

* Break complex jobs into microtasks
* Any agent can claim and complete tasks for x402 bounties
* Automatic task verification and payment release
* Reputation system for reliable agents

### Commerce & Consumer Apps

**Monetized Miniapps**
Use x402 to build frictionless payment experiences:

* No signup or authentication required
* Users pay-as-they-go for features
* Deploy in Farcaster/TBA for distribution
* See [remixme.xyz](https://remixme.xyz) for inspiration

**AI Agent in the Base app**
Create an agent that lives in Base:

* Uses x402 to pay for external services
* Exposes capabilities to end users
* Natural language interface for complex tasks
* Could be a personal assistant, researcher, or trader

**Agentic Commerce Platform**
Enable agents to purchase real goods:

* Integration with AEON or Crossmint for physical goods
* x402 for instant payment processing
* Agent negotiation and price discovery
* Autonomous supply chain management

**Telegram Bot Ecosystem**
Build payment-enabled Telegram bots:

* Use x402 for monetization without complex billing
* Distribute through Telegram's massive user base
* Bonus: Make it work across Telegram, MCP, and other platforms
* Could be games, tools, or content generators

### Protocol Improvements

**x402 Spec Enhancements**
Work with our engineering team to extend the protocol:

* Support for arbitrary tokens beyond USDC
* Multi-network payment routing
* New payment schemes (subscriptions, auctions, etc.)
* Credit-based billing systems
* Enhanced discovery mechanisms

## Getting Help

We're here to help you succeed with x402:

* Get started with x402 implementation
* Review your architecture and approach
* Provide test USDC for Base Sepolia
* Answer any technical questions
* Get your feedback on the protocol

Reach out on [Discord](https://discord.com/invite/cdp/) in the #x402 channel.

## Tips for Success

1. **Start Simple**: Begin with a basic x402 integration, then add complexity
2. **Use Our Examples**: The [x402 repo](https://github.com/coinbase/x402) has complete examples for common use cases
3. **Think Agent-First**: Design your services to be discoverable and usable by AI agents
4. **Leverage Existing Tools**: Combine x402 with AgentKit or embedded wallets for powerful experiences
5. **Test on Sepolia First**: Use Base Sepolia for development, then deploy to mainnet
6. **Document Your API**: Make it easy for agents and developers to understand your endpoints

## Building with x402

Let's bring programmatic payments to the internet and enable the next generation of autonomous agents. We can't wait to see what you build!

* Join our developer community on [Discord](https://discord.com/invite/cdp/)
* Contribute to the [x402 protocol development](https://github.com/coinbase/x402)
* Apply for [CDP's monthly grants program](https://www.coinbase.com/developer-platform/grants)
* Launch your project on mainnet
* Share your learnings with the community



# Quickstart for Buyers

This guide walks you through how to use **x402** to interact with services that require payment. By the end of this guide, you will be able to programmatically discover payment requirements, complete a payment, and access a paid resource.

The x402 helper packages for various languages greatly simplify your integration with x402. You'll be able to automatically detect payment challenges, authorize payments onchain, and retry requests â€” all with minimal code. The packages will automatically trigger the following flow:

1. Makes the initial request (if using Fetch) or intercepts the initial request (if using Axios/HTTPX/Requests)
2. If a 402 response is received, parses the payment requirements
3. Verifies the payment amount is within the allowed maximum
4. Creates a payment header using the provided wallet client
5. Retries the request with the payment header

## Prerequisites

Before you begin, ensure you have:

* A crypto wallet with USDC (any EVM-compatible wallet, e.g., [CDP Wallet](/server-wallets/v1/concepts/wallets), [AgentKit](/agent-kit/welcome))
* [Node.js](https://nodejs.org/en) and npm, or Python and pip
* A service that requires payment via x402

<Info>
  We have pre-configured [examples available in our repo](https://github.com/coinbase/x402/tree/main/examples), including examples for fetch, Axios, and MCP.
</Info>

## 1. Install Dependencies

<Tabs>
  <Tab title="Node.js">
    Install [x402-axios](https://www.npmjs.com/package/x402-axios) or [x402-fetch](https://www.npmjs.com/package/x402-fetch):

    ```bash lines wrap
    npm install x402-axios
    # or
    npm install x402-fetch
    ```
  </Tab>

  <Tab title="Python">
    Install the [x402 package](https://pypi.org/project/x402/):

    ```bash lines wrap
    pip install x402
    ```
  </Tab>
</Tabs>

## 2. Create a Wallet Client

Create a wallet client using CDP's [Server Wallet](/server-wallets/v1/concepts/wallets) (recommended) or a standalone wallet library ([viem](https://viem.sh/) for Node.js or [eth-account](https://github.com/ethereum/eth-account) for Python).

### CDP Server Wallet (Recommended)

First, create an account at [cdp.coinbase.com](https://cdp.coinbase.com/) and get the following API keys from the portal to store as environment variables:

```bash
# store in .env or using the command `export <name>="secret-info"`
CDP_API_KEY_ID=your-api-key-id
CDP_API_KEY_SECRET=your-api-key-secret
CDP_WALLET_SECRET=your-wallet-secret
```

Then, install the required packages:

<CodeGroup>
  ```bash Node.js
  npm install @coinbase/cdp-sdk dotenv
  ```

  ```bash Python
  pip install cdp python-dotenv
  ```
</CodeGroup>

Finally, instantiate the CDP client as suggested by the [Server Wallet Quickstart](/server-wallets/v2/introduction/quickstart):

<CodeGroup>
  ```typescript Node.js
  import { CdpClient } from "@coinbase/cdp-sdk";
  import { toAccount } from "viem/accounts";
  import dotenv from "dotenv";

  dotenv.config()

  const cdp = new CdpClient();
  const cdpAccount = await cdp.evm.createAccount();
  const account = toAccount(cdpAccount);
  ```

  ```python Python
  import asyncio
  from cdp import CdpClient
  from dotenv import load_dotenv

  load_dotenv()

  cdp = CdpClient()
  account = await cdp.evm.create_account()
  ```
</CodeGroup>

### Standalone Wallet Libraries

If you prefer to use your own wallet, you can use standalone libraries:

<Tabs>
  <Tab title="Node.js (viem)">
    Install the required package:

    ```bash
    npm install viem
    ```

    Then instantiate the wallet account:

    ```typescript
    import { createWalletClient, http } from "viem";
    import { privateKeyToAccount } from "viem/accounts";
    import { baseSepolia } from "viem/chains";

    // Create a wallet client (using your private key)
    const account = privateKeyToAccount("0xYourPrivateKey"); // we recommend using an environment variable for this
    ```
  </Tab>

  <Tab title="Python (eth-account)">
    Install the required package:

    ```bash
    pip install eth_account
    ```

    Then instantiate the wallet account:

    ```python
    from eth_account import Account

    account = Account.from_key("your_private_key") # we recommend using an environment variable for this
    ```
  </Tab>
</Tabs>

## 3. Make Paid Requests Automatically

You can automatically handle 402 Payment Required responses and complete payment flows using the x402 helper packages.

<Tabs>
  <Tab title="Node.js">
    You can use either `x402-fetch` or `x402-axios`:

    <Tabs>
      <Tab title="x402-fetch">
        **x402-fetch** extends the native `fetch` API to handle 402 responses and payment headers for you. [Full example here](https://github.com/coinbase/x402/tree/main/examples/typescript/clients/fetch)

        ```typescript
        import { wrapFetchWithPayment, decodeXPaymentResponse } from "x402-fetch";

        const fetchWithPayment = wrapFetchWithPayment(fetch, account);

        fetchWithPayment(url, { //url should be something like https://api.example.com/paid-endpoint
        method: "GET",
        })
        .then(async response => {
            const body = await response.json();
            console.log(body);

            const paymentResponse = decodeXPaymentResponse(response.headers.get("x-payment-response")!);
            console.log(paymentResponse);
        })
        .catch(error => {
            console.error(error.response?.data?.error);
        });
        ```

        **Features:**

        * Automatically handles 402 Payment Required responses
        * Verifies payment and generates payment headers
        * Retries the request with proof of payment
        * Supports all standard fetch options
      </Tab>

      <Tab title="x402-axios">
        **x402-axios** adds a payment interceptor to Axios, so your requests are retried with payment headers automatically. [Full example here](https://github.com/coinbase/x402/tree/main/examples/typescript/clients/axios)

        ```typescript
        import { withPaymentInterceptor, decodeXPaymentResponse } from "x402-axios";
        import axios from "axios";

        // Create an Axios instance with payment handling
        const api = withPaymentInterceptor(
        axios.create({
            baseURL, // e.g. https://api.example.com
        }),
        account,
        );

        api
        .get(endpointPath) // e.g. /paid-endpoint
        .then(response => {
            console.log(response.data);

            const paymentResponse = decodeXPaymentResponse(response.headers["x-payment-response"]);
            console.log(paymentResponse);
        })
        .catch(error => {
            console.error(error.response?.data?.error);
        });
        ```

        **Features:**

        * Automatically handles 402 Payment Required responses
        * Retries requests with payment headers
        * Exposes payment response headers
      </Tab>
    </Tabs>
  </Tab>

  <Tab title="Python">
    You can use either `httpx` or `Requests`:

    * **Requests** is a well-established library for **synchronous** HTTP requests. Simple and ideal for straightforward, sequential workflows.
    * **HTTPX** is a modern library that supports both **synchronous** and **asynchronous** HTTP requests. Use if you need high concurrency or async capabilities.

    Both support a **simple** and **extensible** approach. The simple approach (shown below) returns a pre-configured client that handles payments automatically.

    <Tabs>
      <Tab title="HTTPX">
        [Full example here](https://github.com/coinbase/x402/tree/main/examples/python/clients/httpx)

        ```python
        from x402.clients.httpx import x402HttpxClient
        # Other imports...

        # Wallet creation logic ...

        # Create client and make request
        async with x402HttpxClient(account=account, base_url="https://api.example.com") as client:
            response = await client.get("/protected-endpoint")
            print(await response.aread())
        ```
      </Tab>

      <Tab title="Requests">
        [Full example here](https://github.com/coinbase/x402/tree/main/examples/python/clients/requests)

        ```python
        from x402.clients.requests import x402_requests
        # Other imports...

        # Wallet creation logic ...

        # Create session and make request
        session = x402_requests(account)
        response = session.get("https://api.example.com/protected-endpoint")
        print(response.content)
        ```
      </Tab>
    </Tabs>
  </Tab>
</Tabs>

## 4. Discover Available Services (Optional)

Instead of hardcoding endpoints, you can use the x402 Bazaar to dynamically discover available services. This is especially powerful for building autonomous agents that can find and use new capabilities.

See the full example here for [Python](https://github.com/coinbase/x402/tree/main/examples/python/discovery) and [Node.js](https://github.com/coinbase/x402/tree/main/examples/typescript/discovery).

<Tabs>
  <Tab title="Node.js">
    ```typescript
    import { useFacilitator } from "x402/verify";
    import { facilitator } from "@coinbase/x402";

    // Get the list function from the facilitator
    const { list } = useFacilitator(facilitator);

    // Discover all available x402 services
    const services = await list();
    ```
  </Tab>

  <Tab title="Python">
    ```python
    from x402.facilitator import FacilitatorClient
    from cdp.x402 import create_facilitator_config

    # Set up facilitator client
    facilitator_config = create_facilitator_config()
    facilitator = FacilitatorClient(facilitator_config)

    # Discover all available x402 services
    services = await facilitator.list()
    ```
  </Tab>
</Tabs>

<Info>
  Learn more about service discovery in the [x402 Bazaar documentation](/x402/bazaar), including how to filter services, understand their schemas, and build agents that can autonomously discover new capabilities.
</Info>

## 5. Error Handling

Clients will throw errors if:

* The request configuration is missing
* A payment has already been attempted for the request
* There is an error creating the payment header

## Summary

* Install an x402 client package
* Create a wallet client
* Use the provided wrapper/interceptor to make paid API requests
* (Optional) Use the x402 Bazaar to discover services dynamically
* Payment flows are handled automatically for you

## References:

* [x402-fetch npm docs](https://www.npmjs.com/package/x402-fetch)
* [x402-axios npm docs](https://www.npmjs.com/package/x402-axios)
* [x402 PyPi page](https://pypi.org/project/x402/)
* [x402 Bazaar documentation](/x402/bazaar) - Discover available services

For questions or support, join our [Discord](https://discord.gg/invite/cdp).




# Quickstart for Sellers

This guide walks you through integrating with x402 to enable payments for your API or service. By the end, your API will be able to charge buyers and AI agents for access.

<Note>
  This quickstart begins with testnet configuration for safe testing. When you're ready for production, see [Running on Mainnet](#running-on-mainnet) for the simple changes needed to accept real payments.
</Note>

## Prerequisites

Before you begin, ensure you have:

* A crypto wallet to receive funds (any EVM-compatible wallet, e.g., [CDP Wallet](/server-wallets/v1/concepts/wallets))
* (Optional) A [Coinbase Developer Platform](https://cdp.coinbase.com) (CDP) account and API Keys
  * Required for mainnet use until other facilitators go live
* [Node.js](https://nodejs.org/en) and npm, or Python and pip installed
* An existing API or server

<Info>
  We have pre-configured examples available in our repo for both [Node.js](https://github.com/coinbase/x402/tree/main/examples/typescript/servers) and [Python](https://github.com/coinbase/x402/tree/main/examples/python/servers). We also have an [advanced example](https://github.com/coinbase/x402/tree/main/examples/typescript/servers/advanced) that shows how to use the x402 SDKs to build a more complex payment flow.
</Info>

## 1. Install Dependencies

<Tabs>
  <Tab title="Node.js">
    <Tabs>
      <Tab title="Express">
        Install the [x402 Express middleware package](https://www.npmjs.com/package/x402-express):

        ```bash
        npm install x402-express
        npm install @coinbase/x402 # for the mainnet facilitator
        ```
      </Tab>

      <Tab title="Next.js">
        Install the [x402 Next.js middleware package](https://www.npmjs.com/package/x402-next):

        ```bash
        npm install x402-next
        npm install @coinbase/x402 # for the mainnet facilitator
        ```
      </Tab>

      <Tab title="Hono">
        Install the [x402 Hono middleware package](https://www.npmjs.com/package/x402-hono):

        ```bash
        npm install x402-hono
        npm install @coinbase/x402 # for the mainnet facilitator
        ```
      </Tab>
    </Tabs>
  </Tab>

  <Tab title="Python">
    Install the [x402 Python package](https://pypi.org/project/x402/):

    ```bash
    pip install x402
    pip install cdp # for the mainnet facilitator
    ```
  </Tab>
</Tabs>

<Note>
  The mainnet facilitator packages (`@coinbase/x402` for Node.js, `cdp` for Python) are only needed for production. For testnet development, you can skip these. See [Running on Mainnet](#running-on-mainnet) for details.
</Note>

## 2. Add Payment Middleware

Integrate the payment middleware into your application. You will need to provide:

* The Facilitator URL or facilitator object. For testing, use `https://x402.org/facilitator` which works on Base Sepolia.
  * For mainnet setup, see [Running on Mainnet](#running-on-mainnet)
* The routes you want to protect
* Your receiving wallet address

<Tip>
  The examples below show testnet configuration. When you're ready to accept real payments, refer to [Running on Mainnet](#running-on-mainnet) for the simple changes needed.
</Tip>

<Tabs>
  <Tab title="Node.js">
    <Tabs>
      <Tab title="Express">
        Full example in the repo [here](https://github.com/coinbase/x402/tree/main/examples/typescript/servers/express).

        ```js
        import express from "express";
        import { paymentMiddleware, Network } from "x402-express";
        // import { facilitator } from "@coinbase/x402"; // For mainnet

        const app = express();

        app.use(paymentMiddleware(
          "0xYourAddress", // your receiving wallet address
          {  // Route configurations for protected endpoints
            "GET /weather": {
              // USDC amount in dollars
              price: "$0.001",
              network: "base-sepolia", // for mainnet, see Running on Mainnet section
              // Optional: Add metadata for better discovery in x402 Bazaar
              config: {
                description: "Get current weather data for any location",
                inputSchema: {
                  type: "object",
                  properties: {
                    location: { type: "string", description: "City name" }
                  }
                },
                outputSchema: {
                  type: "object",
                  properties: {
                    weather: { type: "string" },
                    temperature: { type: "number" }
                  }
                }
              }
            },
          },
          {
            url: "https://x402.org/facilitator", // for testnet
          }
        ));

        // Implement your route
        app.get("/weather", (req, res) => {
          res.send({
            report: {
              weather: "sunny",
              temperature: 70,
            },
          });
        });

        app.listen(4021, () => {
          console.log(`Server listening at http://localhost:4021`);
        });
        ```
      </Tab>

      <Tab title="Next.js">
        Full example in the repo [here](https://github.com/coinbase/x402/tree/main/examples/typescript/fullstack/next).

        ```js
        import { paymentMiddleware, Network } from 'x402-next';
        // import { facilitator } from "@coinbase/x402"; // For mainnet

        // Configure the payment middleware
        export const middleware = paymentMiddleware(
          "0xYourAddress", // your receiving wallet address
          {  // Route configurations for protected endpoints
            '/protected': {
              price: '$0.01',
              network: "base-sepolia", // for mainnet, see Running on Mainnet section
              config: {
                description: 'Access to protected content',
                // Optional: Add schemas for better discovery
                inputSchema: {
                  type: "object",
                  properties: {}
                },
                outputSchema: {
                  type: "object",
                  properties: {
                    content: { type: "string" }
                  }
                }
              }
            },
          },
          {
            url: "https://x402.org/facilitator", // for testnet
          }
        );

        // Configure which paths the middleware should run on
        export const config = {
          matcher: [
            '/protected/:path*',
          ]
        };
        ```
      </Tab>

      <Tab title="Hono">
        Full example in the repo [here](https://github.com/coinbase/x402/tree/main/examples/typescript/servers/hono).

        ```js
        import { Hono } from "hono";
        import { serve } from "@hono/node-server";
        import { paymentMiddleware, Network } from "x402-hono";
        // import { facilitator } from "@coinbase/x402"; // For mainnet

        const app = new Hono();

        // Configure the payment middleware
        app.use(paymentMiddleware(
          "0xYourAddress", // your receiving wallet address
          {  // Route configurations for protected endpoints
            "/protected-route": {
              price: "$0.10",
              network: "base-sepolia", // for mainnet, see Running on Mainnet section
              config: {
                description: "Access to premium content",
              }
            }
          },
          {
            url: "https://x402.org/facilitator", // for testnet
          }
        ));

        // Implement your route
        app.get("/protected-route", (c) => {
          return c.json({ message: "This content is behind a paywall" });
        });

        serve({
          fetch: app.fetch,
          port: 3000
        });
        ```
      </Tab>
    </Tabs>
  </Tab>

  <Tab title="Python">
    <Tabs>
      <Tab title="FastAPI">
        Full example in the repo [here](https://github.com/coinbase/x402/tree/main/examples/python/servers/fastapi).

        ```python
        import os
        from typing import Any, Dict
        from dotenv import load_dotenv
        from fastapi import FastAPI
        from x402.fastapi.middleware import require_payment
        from x402.types import EIP712Domain, TokenAmount, TokenAsset

        # Load environment variables
        load_dotenv()

        app = FastAPI()

        # Apply payment middleware to specific routes
        app.middleware("http")(
            require_payment(
                path="/weather",
                price="$0.001",
                pay_to_address="0xYourAddress",
                network_id="base-sepolia", # for mainnet, see Running on Mainnet section
                # Optional: Add metadata for better discovery in x402 Bazaar
                description="Get current weather data for any location",
                input_schema={
                    "type": "object",
                    "properties": {
                        "location": {"type": "string", "description": "City name"}
                    }
                },
                output_schema={
                    "type": "object",
                    "properties": {
                        "weather": {"type": "string"},
                        "temperature": {"type": "number"}
                    }
                }
            )
        )

        @app.get("/weather")
        async def get_weather() -> Dict[str, Any]:
            return {
                "report": {
                    "weather": "sunny",
                    "temperature": 70,
                }
            }
        ```
      </Tab>

      <Tab title="Flask">
        Full example in the repo [here](https://github.com/coinbase/x402/tree/main/examples/python/servers/flask).

        ```python
        import os
        from flask import Flask, jsonify
        from dotenv import load_dotenv
        from x402.flask.middleware import PaymentMiddleware
        from x402.types import EIP712Domain, TokenAmount, TokenAsset

        # Load environment variables
        load_dotenv()

        app = Flask(__name__)

        # Initialize payment middleware
        payment_middleware = PaymentMiddleware(app)

        # Apply payment middleware to specific routes
        payment_middleware.add(
            path="/weather",
            price="$0.001",
            pay_to_address="0xYourAddress",
            network="base-sepolia", # for mainnet, see Running on Mainnet section
            # Optional: Add metadata for better discovery in x402 Bazaar
            description="Get current weather data for any location",
            input_schema={
                "type": "object",
                "properties": {
                    "location": {"type": "string", "description": "City name"}
                }
            },
            output_schema={
                "type": "object",
                "properties": {
                    "weather": {"type": "string"},
                    "temperature": {"type": "number"}
                }
            }
        )

        @app.route("/weather")
        def get_weather():
            return jsonify({
                "report": {
                    "weather": "sunny",
                    "temperature": 70,
                }
            })
        ```
      </Tab>
    </Tabs>
  </Tab>
</Tabs>

<Note>
  Ready to accept real payments? See [Running on Mainnet](#running-on-mainnet) for production setup.
</Note>

**Payment Middleware Configuration Interface:**

```typescript
interface PaymentMiddlewareConfig {
  description?: string;               // Description of the payment
  mimeType?: string;                  // MIME type of the resource
  maxTimeoutSeconds?: number;         // Maximum time for payment (default: 60)
  outputSchema?: Record;              // JSON schema for the response
  customPaywallHtml?: string;         // Custom HTML for the paywall
  resource?: string;                  // Resource URL (defaults to request URL)
}
```

When a request is made to these routes without payment, your server will respond with the HTTP 402 Payment Required code and payment instructions.

## 3. Test Your Integration

To verify:

1. Make a request to your endpoint (e.g., `curl http://localhost:3000/your-endpoint`).
2. The server responds with a 402 Payment Required, including payment instructions in the body.
3. Complete the payment using a compatible client, wallet, or automated agent. This typically involves signing a payment payload, which is handled by the client SDK detailed in the [Quickstart for Buyers](/x402/quickstart-for-buyers).
4. Retry the request, this time including the `X-PAYMENT` header containing the cryptographic proof of payment (payment payload).
5. The server verifies the payment via the facilitator and, if valid, returns your actual API response (e.g., `{ "data": "Your paid API response." }`).

## 4. Enhance Discovery with Metadata (Recommended)

When using the CDP facilitator, your endpoints are **automatically listed** in the [x402 Bazaar](/x402/bazaar), our discovery layer that helps buyers and AI agents find services. To improve your visibility and help users understand your API:

<Tip>
  **Include descriptive metadata** in your middleware configuration:

  * **`description`**: Clear explanation of what your endpoint does
  * **`inputSchema`**: JSON schema describing required parameters
  * **`outputSchema`**: JSON schema of your response format

  This metadata helps:

  * AI agents automatically understand how to use your API
  * Developers quickly find services that meet their needs
  * Improve your ranking in discovery results
</Tip>

Example with full metadata:

```javascript
{
  price: "$0.001",
  network: "base",
  config: {
    description: "Get real-time weather data including temperature, conditions, and humidity",
    inputSchema: {
      type: "object",
      properties: {
        location: { 
          type: "string", 
          description: "City name or coordinates (e.g., 'San Francisco' or '37.7749,-122.4194')" 
        },
        units: { 
          type: "string", 
          enum: ["celsius", "fahrenheit"],
          default: "fahrenheit"
        }
      },
      required: ["location"]
    },
    outputSchema: {
      type: "object",
      properties: {
        temperature: { type: "number", description: "Current temperature" },
        conditions: { type: "string", description: "Weather conditions (sunny, cloudy, rainy, etc.)" },
        humidity: { type: "number", description: "Humidity percentage" }
      }
    }
  }
}
```

Learn more about the discovery layer in the [x402 Bazaar documentation](/x402/bazaar).

## 5. Error Handling

* If you run into trouble, check out the examples in the [repo](https://github.com/coinbase/x402/tree/main/examples) for more context and full code.
* `npm install` the dependencies in each example

## Running on Mainnet

Once you've tested your integration on testnet, you're ready to accept real payments on mainnet. Here's what you need to do:

<Frame>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/Zc_wBlDY2Zc" title="Running x402 on Mainnet" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen className="rounded-lg w-full" />
</Frame>

### 1. Set up CDP API Keys

To use the mainnet facilitator, you'll need a Coinbase Developer Platform account:

1. Sign up at [cdp.coinbase.com](https://cdp.coinbase.com)
2. Create a new project
3. Generate API credentials
4. Set the following environment variables:
   ```bash
   CDP_API_KEY_ID=your-api-key-id
   CDP_API_KEY_SECRET=your-api-key-secret
   ```

### 2. Update Your Code

Replace the testnet configuration with mainnet settings:

<Tabs>
  <Tab title="Node.js">
    ```js
    // Change your imports
    import { facilitator } from "@coinbase/x402";

    // Update the middleware configuration
    app.use(paymentMiddleware(
      "0xYourAddress",
      {
        "GET /weather": {
          price: "$0.001",
          network: "base",
        },
      },
      facilitator // this was previously { url: "https://x402.org/facilitator" }
    ));


    // or for Next.js
    export const middleware = paymentMiddleware(
      "0xYourAddress",
      {
        "GET /weather": {
          price: "$0.001",
          network: "base",
        },
      },
      facilitator // this was previously { url: "https://x402.org/facilitator" }
    ));
    ```
  </Tab>

  <Tab title="Python">
    ```python
    from cdp.x402 import create_facilitator_config

    facilitator_config = create_facilitator_config(
        api_key_id=CDP_API_KEY_ID,
        api_key_secret=CDP_API_KEY_SECRET,
    )

    # Update the middleware configuration (FastAPI)
    app.middleware("http")(
        require_payment(
            path="/weather",
            price="$0.001",
            pay_to_address="0xYourAddress",
            network_id="base", # Changed from "base-sepolia"
            facilitator_config=facilitator_config,
        )
    )

    # Or for Flask:
    payment_middleware.add(
        path="/weather",
        price="$0.001",
        pay_to_address="0xYourAddress",
        network="base", # Changed from "base-sepolia"
        facilitator_config=facilitator_config,
    )
    ```
  </Tab>
</Tabs>

### 3. Update Your Wallet

Make sure your receiving wallet address (`0xYourAddress`) is a real mainnet address where you want to receive USDC payments.

### 4. Test with Real Payments

Before going live:

1. Test with small amounts first
2. Verify payments are arriving in your wallet
3. Monitor the facilitator for any issues

<Warning>
  Mainnet transactions involve real money. Always test thoroughly on testnet first and start with small amounts on mainnet.
</Warning>

## Next Steps

* Looking for something more advanced? Check out the [Advanced Example](https://github.com/coinbase/x402/tree/main/examples/typescript/servers/advanced)
* Get started as a [buyer](/x402/quickstart-for-buyers)

For questions or support, join our [Discord](https://discord.gg/invite/cdp).

## Summary

This quickstart covered:

* Installing the x402 SDK and relevant middleware
* Adding payment middleware to your API and configuring it
* Testing your integration

Your API is now ready to accept crypto payments through x402.




# x402 Bazaar (Discovery Layer)

The x402 Bazaar is the discovery layer for the x402 ecosystem - a machine-readable catalog that helps developers and AI agents find and integrate with x402-compatible API endpoints. Think of it as a search index for payable APIs, enabling the autonomous discovery and consumption of services.

<Note>
  The x402 Bazaar is in early development. While our vision is to build the "Google for agentic endpoints," we're currently more like "Yahoo search" - functional but evolving. Features and APIs may change as we gather feedback and expand capabilities.
</Note>

## Overview

The Bazaar solves a critical problem in the x402 ecosystem: **discoverability**. Without it, x402-compatible endpoints are like hidden stalls in a vast market. The Bazaar provides:

* **For Buyers (API Consumers)**: Programmatically discover available x402-enabled services, understand their capabilities, pricing, and schemas
* **For Sellers (API Providers)**: Automatic visibility for your x402-enabled services to a global audience of developers and AI agents
* **For AI Agents**: Dynamic service discovery without pre-baked integrations - query, find, pay, and use

## How It Works

The Bazaar currently provides a simple `/list` endpoint that returns all x402-compatible services registered with the CDP facilitator. If your API uses the latest version of the CDP facilitator for x402 payments, it's ingested in the bazaar if you make the discoverable flag true in the input schema (see [Quickstart for Sellers](#quickstart-for-sellers)).

### Basic Flow

1. **Discovery**: Clients query the `/list` endpoint to find available services
2. **Selection**: Choose a service based on price, capabilities, and requirements
3. **Execution**: Use x402 to pay for and access the selected service
4. **No Manual Setup**: No API keys, no account creation, just discover and pay

## API Reference

### List Endpoint

Retrieve all available x402-compatible endpoints:

```bash
GET https://api.cdp.coinbase.com/platform/v2/x402/discovery/resources
```

Note: the recommended way to use this endpoint is to use the `useFacilitator` hook as described [below](#quickstart-for-buyers).

#### Response Schema

Each endpoint in the list contains the following fields:

```json
{
      "accepts": [
        {
          "asset": "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913", // ERC-20 token contract address accepted for payment (here, USDC on Base)
          "description": "", // Optional description of the accepted payment
          "extra": {
            "name": "USD Coin", // Human-readable name of the asset
            "version": "2" // Version of the asset, if applicable
          },
          "maxAmountRequired": "200", // Maximum amount (in atomic units, e.g USDC has 6 decimals) required for the service
          "maxTimeoutSeconds": 60, // Maximum time (in seconds) the service will wait for payment before expiring
          "mimeType": "", // Expected MIME type for the response (optional/empty if not specified)
          "network": "base", // network where payment is accepted (e.g., 'base' for Base L2)
          "outputSchema": {
            "input": {
              "method": "GET", // HTTP method to use when calling the resource
              "type": "http" // Type of resource (e.g., 'http' endpoint)
            },
            "output": null // Output schema (null if not specified)
          },
          "payTo": "0xa2477E16dCB42E2AD80f03FE97D7F1a1646cd1c0", // Address to which payment should be sent
          "resource": "https://api.example.com/x402/last_sold", // The actual API endpoint/resource URL
          "scheme": "exact" // Payment scheme (e.g., 'exact' means exact amount required)
        }
      ],
      "lastUpdated": "2025-08-09T01:07:04.005Z", 
      "metadata": {}, // Additional metadata about the service (empty object if none)
      "resource": "https://api.prixe.io/x402/last_sold", // The main resource URL for this service
      "type": "http", 
      "x402Version": 1 // Version of the x402 protocol supported
    },
```

## Quickstart for Buyers

See the full example here for [Python](https://github.com/coinbase/x402/tree/main/examples/python/discovery) and [Node.js](https://github.com/coinbase/x402/tree/main/examples/typescript/discovery).

### Step 1: Discover Available Services

Fetch the list of available x402 services using the facilitator client:

<Tabs>
  <Tab title="Node.js">
    ```typescript
    import { useFacilitator } from "x402/verify";
    import { facilitator } from "@coinbase/x402";

    // Get the list function from the facilitator
    const { list } = useFacilitator(facilitator);

    // Fetch all available services
    const services = await list();

    // NOTE: in an MCP context, you can see the full list then decide which service to use

    // Find services under $0.10
    const usdcAsset = "0x036CbD53842c5426634e7929541eC2318f3dCF7e";
    const maxPrice = 100000;

    const affordableServices = services.items.filter(item => item.accepts.find(paymentRequirements => paymentRequirements.asset == usdcAsset && Number(paymentRequirements.maxAmountRequired) < maxPrice));
    ```
  </Tab>

  <Tab title="Python">
    ```python
    from x402.facilitator import FacilitatorClient, FacilitatorConfig
    from cdp.x402 import create_facilitator_config

    # Set up facilitator client
    facilitator_config = create_facilitator_config()
    facilitator = FacilitatorClient(facilitator_config)

    # Fetch all available services
    services = await facilitator.list()

    # NOTE: in an MCP context, you can see the full list then decide which service to use

    # Find services under $0.10
    usdc_asset = "0x036CbD53842c5426634e7929541eC2318f3dCF7e"
    max_price = 100000

    affordable_services = [
      item
      for item in services.items
      if any(
        payment_req.asset == usdc_asset
        and int(payment_req.max_amount_required) < max_price
        for payment_req in item.accepts
       )
      ]
    ```
  </Tab>
</Tabs>

### Step 2: Call a Discovered Service

Once you've found a suitable service, use an x402 client to call it:

<Tabs>
  <Tab title="Node.js">
    ```typescript
    import { withPaymentInterceptor } from 'x402-axios';
    import axios from 'axios';
    import { privateKeyToAccount } from 'viem/accounts';

    // Set up your payment account
    const account = privateKeyToAccount('0xYourPrivateKey');

    // Select a service from discovery
    const selectedService = affordableServices[0];

    // Create a payment-enabled client for that service
    const client = withPaymentInterceptor(
      axios.create({ baseURL: selectedService.endpoint }), 
      account
    );

    // Select the payment method of your choice
    const selectedPaymentRequirements = selectedService.accepts[0];
    const inputSchema = selectedPaymentRequirements.outputSchema.input;

    // Build the request using the service's schema
    const response = await client.request({
      method: inputSchema.method,
      url: inputSchema.resource,
      params: { location: 'San Francisco' } // Based on inputSchema
    });

    console.log('Response data:', response.data);
    ```
  </Tab>

  <Tab title="Python">
    ```python
    from x402.client import X402Client
    from eth_account import Account

    # Set up your payment account
    account = Account.from_key('0xYourPrivateKey')
    client = X402Client(account)

    # Select a service from discovery
    selected_service = affordable_services[0]

    # Select the payment method of your choice
    selected_payment_requirements = selected_service.accepts[0]
    input_schema = selected_payment_requirements.output_schema.input

    # Make the request
    response = client.request({
        method=input_schema.method,
        url=input_schema.resource,
        params={ "location": "San Francisco" } # Based on input_schema
    })

    print(f"Response data: {response}")
    ```
  </Tab>
</Tabs>

## Quickstart for Sellers

### Automatic Listing with Discoverable Flag

If your API uses the latest version of the CDP facilitator for x402 payments, it's ingested in the bazaar if you make the discoverable flag true in the input schema (see below).

### Adding Metadata

To enhance your listing with descriptions and schemas, include them when setting up your x402 middleware. You should include descriptions for each parameter to make it clear for the agent to call your endpoints:

<Tabs>
  <Tab title="Node.js">
    ```typescript
    // Next.js / Express / Hono
    import { require402Payment } from 'x402-express';

    app.use(require402Payment({
      routes: {
        "/api/weather": {
          price: "$0.001",
          network: "base",
          config: {
            discoverable: true, // make your endpoint discoverable
            description: "Get current weather data for any location",
            inputSchema: { 
              queryParams: { 
                location: { 
                  type: string, 
                  description: "City name or coordinates", 
                  required: true
                }
              }
            },
            outputSchema: {
              type: "object",
              properties: { 
                temperature: { type: "number" },
                conditions: { type: "string" },
                humidity: { type: "number" }
              }
            }
          }
        }
      }
    }));
    ```
  </Tab>

  <Tab title="Python">
    ```python
    # FastAPI / Flask
    from x402 import require_payment

    app.middleware("http")(
        require_payment(
            path="/weather",
            price="$0.001",
            pay_to_address=WALLET_ADDRESS,
            network="base",
            description="Get current weather data for any location",
            discoverable=true, # make your endpoint discoverable <----
            input_schema={
                "queryParams": {
                    "location": {
                        "type": string,
                        "description": "City name or coordinates",
                        "required": true
                    }
                }
            },
            output_schema={
                "type": "object",
                "properties": {
                    "temperature": {"type": "number"},
                    "conditions": {"type": "string"},
                    "humidity": {"type": "number"}
                }
            }
        )
    )
    ```
  </Tab>
</Tabs>

## Coming Soon

The x402 Bazaar is rapidly evolving, and your feedback helps us prioritize features.

## Support

* **GitHub**: [github.com/coinbase/x402](https://github.com/coinbase/x402)
* **Discord**: [Join #x402 channel](https://discord.com/invite/cdp)
* **Documentation**: [x402 Overview](/x402/welcome)

## FAQ

**Q: How do I get my service listed?**
A: If you're using the CDP facilitator, your service is listed once you include the discoverable flag

**Q: How can I make endpoint calls more accurate?**
A: Include descriptions clearly stating what each parameter does and how to call your endpoint, but do so as succinctly as possible.

**Q: Can I opt out of the Bazaar?**
A: Soon, will be able to manage your listing preferences.

**Q: How does pricing work?**
A: Listing is free. Services set their own prices per API call, paid via x402.

**Q: What networks are supported?**
A: Currently Base (mainnet) with USDC payments.

**Q: Can I list non-x402 services?**
A: No, only x402-compatible endpoints can be listed. See our [seller quickstart](/x402/quickstart-for-sellers) to make your API x402-compatible.




# How x402 Works

This page explains the complete payment flow in x402, from initial request to payment settlement.

## Overview

x402 enables programmatic payments over HTTP using a simple request-response flow. When a client requests a paid resource, the server responds with payment requirements, the client submits payment, and the server delivers the resource.

## Payment Flow

<img src="https://mintlify.s3.us-west-1.amazonaws.com/coinbase-prod/x402/images/x402-protocol-flow.png" />

### Step-by-Step Process

1. **Client makes HTTP request** - The [client](/x402/core-concepts/client-server) sends a standard HTTP request to a resource server for a protected endpoint.

2. **Server responds with 402** - The resource server returns an [HTTP 402 Payment Required](/x402/core-concepts/http-402) status code with payment details in the response body.

3. **Client creates payment** - The client examines the payment requirements and creates a payment payload using their [wallet](/x402/core-concepts/wallet) based on the specified scheme.

4. **Client resubmits with payment** - The client sends the same HTTP request again, this time including the `X-PAYMENT` header containing the signed payment payload.

5. **Server verifies payment** - The resource server validates the payment payload either:
   * Locally (if running their own verification)
   * Via a [facilitator](/x402/core-concepts/facilitator) service (recommended)

6. **Facilitator validates** - If using a facilitator, it checks the payment against the scheme and network requirements, returning a verification response.

7. **Server processes request** - If payment is valid, the server fulfills the original request. If invalid, it returns another 402 response.

8. **Payment settlement** - The server initiates blockchain settlement either:
   * Directly by submitting to the blockchain
   * Through the facilitator's `/settle` endpoint

9. **Facilitator submits onchain** - The facilitator broadcasts the transaction to the blockchain based on the payment's network and waits for confirmation.

10. **Settlement confirmation** - Once confirmed onchain, the facilitator returns a payment execution response.

11. **Server delivers resource** - The server returns a 200 OK response with:
    * The requested resource in the response body
    * An `X-PAYMENT-RESPONSE` header containing the settlement details

## Key Components

* **[Client & Server](/x402/core-concepts/client-server)** - The roles and responsibilities of each party
* **[Facilitator](/x402/core-concepts/facilitator)** - Optional service that handles payment verification and settlement
* **[HTTP 402](/x402/core-concepts/http-402)** - How payment requirements are communicated
* **[Networks & Facilitators](/x402/network-support)** - Available networks and facilitator options

## Why This Design?

The x402 protocol is designed to be:

* **Stateless** - No sessions or authentication required
* **HTTP-native** - Works with existing web infrastructure
* **Blockchain-agnostic** - Supports multiple networks through facilitators
* **Developer-friendly** - Simple integration with standard HTTP libraries

## Next Steps

* Ready to accept payments? See [Quickstart for Sellers](/x402/quickstart-for-sellers)
* Want to make payments? See [Quickstart for Buyers](/x402/quickstart-for-buyers)
* Looking for specific networks? Check [Network Support](/x402/network-support)




# HTTP 402

For decades, HTTP 402 Payment Required has been reserved for future use. x402 unlocks it, and [absolves the internet of its original sin](https://economyofbits.substack.com/p/marc-andreessens-original-sin).

## What is HTTP 402?

[HTTP 402](https://datatracker.ietf.org/doc/html/rfc7231#section-6.5.2) is a standard, but rarely used, HTTP response status code indicating that payment is required to access a resource.

In x402, this status code is activated to:

* Inform clients (buyers or agents) that payment is required.
* Communicate the details of the payment, such as amount, currency, and destination address.
* Provide the information necessary to complete the payment programmatically.

## Why x402 Uses HTTP 402

The primary purpose of HTTP 402 is to enable frictionless, API-native payments for accessing web resources, especially for:

* Machine-to-machine (M2M) payments (e.g., AI agents).
* Pay-per-use models such as API calls or paywalled content.
* Micropayments without account creation or traditional payment rails.

Using the 402 status code keeps x402 protocol natively web-compatible and easy to integrate into any HTTP-based service.

## Summary

HTTP 402 is the foundation of the x402 protocol, enabling services to declare payment requirements directly within HTTP responses. It:

* Signals payment is required
* Communicates necessary payment details
* Integrates seamlessly with standard HTTP workflows

## Next Steps

* [How x402 Works](/x402/core-concepts/how-it-works) â€” See how HTTP 402 fits into the complete payment flow
* [Client & Server](/x402/core-concepts/client-server) â€” Understand the roles in the x402 protocol
* [Quickstart for Sellers](/x402/quickstart-for-sellers) â€” Start implementing HTTP 402 responses



# Client / Server Flow

This page explains the roles and responsibilities of the **client** and **server** in the x402 protocol.

Understanding these roles is essential to designing, building, or integrating services that use x402 for programmatic payments.

<Info>
  Client refers to the technical component making an HTTP request. In practice, this is often the buyer of the resource.

  Server refers to the technical component responding to the request. In practice, this is typically the seller of the resource
</Info>

## Client Role

The client is the entity that initiates a request to access a paid resource.

Clients can include:

* Human-operated applications
* Autonomous agents
* Programmatic services acting on behalf of users or systems

### Responsibilities

* **Initiate requests:** Send an HTTP request to the resource server.
* **Handle payment requirements:** Read the `402 Payment Required` response and extract payment details.
* **Prepare payment payload:** Use the provided payment requirements to construct a valid payment payload.
* **Resubmit request with payment:** Retry the request with the `X-PAYMENT` header containing the signed payment payload.

Clients do not need to manage accounts, credentials, or session tokens beyond their crypto wallet. All interactions are stateless and occur over standard HTTP requests.

# Server Role

The server is the resource provider enforcing payment for access to its services.

Servers can include:

* API services
* Content providers
* Any HTTP-accessible resource requiring monetization

### Responsibilities

* **Define payment requirements:** Respond to unauthenticated requests with an HTTP `402 Payment Required`, including all necessary payment details in the response body.
* **Verify payment payloads:** Validate incoming payment payloads, either locally or by using a facilitator service.
* **Settle transactions:** Upon successful verification, submit the payment for settlement.
* **Provide the resource:** Once payment is confirmed, return the requested resource to the client.

Servers do not need to manage client identities or maintain session state. Verification and settlement are handled per request.

## How It Works

For a detailed explanation of the complete payment flow between clients and servers, see [How x402 Works](/x402/core-concepts/how-it-works).

## Summary

In the x402 protocol:

* The **client** requests resources and supplies the signed payment payload.
* The **server** enforces payment requirements, verifies transactions, and provides the resource upon successful payment.

This interaction is stateless, HTTP-native, and compatible with both human applications and automated agents.

Next, explore:

* [How x402 Works](/x402/core-concepts/how-it-works) â€” see the complete payment flow
* [Facilitator](/x402/core-concepts/facilitator) â€” how servers verify and settle payments
* [HTTP 402](/x402/core-concepts/http-402) â€” how servers communicate payment requirements to clients



# Facilitator

This page explains the role of the **facilitator** in the x402 protocol.

The facilitator is an optional but recommended service that simplifies the process of verifying and settling payments between clients (buyers) and servers (sellers).

# What is a Facilitator?

The facilitator is a service that:

* Verifies payment payloads submitted by clients.
* Settles payments on the blockchain on behalf of servers.

By using a facilitator, servers do not need to maintain direct blockchain connectivity or implement payment verification logic themselves. This reduces operational complexity and ensures accurate, real-time validation of transactions.

## Facilitator Responsibilities

* **Verify payments:** Confirm that the client's payment payload meets the server's declared payment requirements.
* **Settle payments:** Submit validated payments to the blockchain and monitor for confirmation.
* **Provide responses:** Return verification and settlement results to the server, allowing the server to decide whether to fulfill the client's request.

The facilitator does not hold funds or act as a custodian - it performs verification and execution of onchain transactions based on signed payloads provided by clients.

## Why Use a Facilitator?

Using a facilitator provides:

* **Reduced operational complexity:** Servers do not need to interact directly with blockchain nodes.
* **Protocol consistency:** Standardized verification and settlement flows across services.
* **Faster integration:** Services can start accepting payments with minimal blockchain-specific development.

While it is possible to implement verification and settlement locally, using a facilitator accelerates adoption and ensures correct protocol behavior.

## CDP's Facilitator

Coinbase Developer Platform (CDP) operates a hosted facilitator service.

CDP's x402 facilitator offers:

* **Fee-free USDC payments on Base:** It currently processes transactions without additional fees, allowing sellers to receive 100% of the payment.
* **USDC-only support:** Exclusive support for USDC as the payment asset (for the time being).
* **High performance settlement:** Payments are submitted to the Base network with fast confirmation times and high throughput.

To get started with CDP's facilitator, see the [quickstart for sellers](/x402/quickstart-for-sellers).

Using CDP's facilitator allows sellers to quickly integrate payments without managing blockchain infrastructure, while providing a predictable and low-cost experience for buyers.

## Available Facilitators

For a list of available facilitators and the networks they support, see [Network Support](/x402/network-support).

## How It Works

To understand how facilitators fit into the complete x402 payment flow, see [How x402 Works](/x402/core-concepts/how-it-works).

## Summary

The facilitator acts as an independent verification and settlement layer within the x402 protocol. It helps servers confirm payments and submit transactions onchain without requiring direct blockchain infrastructure.

Coinbase's hosted facilitator simplifies this further by offering a ready-to-use, fee-free environment for USDC payments on Base.

Next, explore:

* [How x402 Works](/x402/core-concepts/how-it-works) â€” see the complete payment flow
* [Network Support](/x402/network-support) â€” find available facilitators and networks
* [HTTP 402](/x402/core-concepts/http-402) â€” understand how payment requirements are communicated




# Wallet

This page explains the role of the **wallet** in the x402 protocol.

In x402, a wallet is both a payment mechanism and a form of unique identity for buyers and sellers. Wallet addresses are used to send, receive, and verify payments, while also serving as identifiers within the protocol.

## Role of the Wallet

### For Buyers

Buyers use wallets to:

* Store USDC
* Sign payment payloads
* Authorize onchain payments programmatically

Wallets enable buyers, including AI agents, to transact without account creation or credential management.

### For Sellers

Sellers use wallets to:

* Receive USDC payments
* Define their payment destination within server configurations

A seller's wallet address is included in the payment requirements provided to buyers.

[CDP's Server Wallet](/server-wallets/v1/concepts/wallets) is our recommended option for programmatic payments and secure key management.

## Summary

* Wallets enable programmatic, permissionless payments in x402.
* Buyers use wallets to pay for services.
* Sellers use wallets to receive payments.
* Wallet addresses also act as unique identifiers within the protocol.

Next, explore:

* [How x402 Works](/x402/core-concepts/how-it-works) â€” See how wallets fit into the payment flow
* [Client & Server](/x402/core-concepts/client-server) â€” Understand buyer and seller roles
* [Quickstart for Sellers](/x402/quickstart-for-sellers) â€” Set up your receiving wallet
* [Quickstart for Buyers](/x402/quickstart-for-buyers) â€” Configure your payment wallet




# Network & Token Support

This page explains which blockchain networks and tokens are supported by x402, and how to [extend support to additional networks](/x402/network-support#adding-support-for-new-networks).

# Overview

x402 is designed to work across multiple blockchain networks, with different levels of support depending on the facilitator being used. The protocol itself is network-agnostic, but facilitators need to implement network-specific logic for payment verification and settlement.

## Supported Facilitators

Network support in x402 depends on which facilitator you use. Here are the currently available facilitators:

### x402.org Facilitator

* **Supports**: Base Sepolia
* **Notes**: Recommended for testing and development. This is the default facilitator in the x402 packages and requires no setup.
* **URL**: [https://x402.org/facilitator](https://x402.org/facilitator)

### CDP's x402 Facilitator

* **Supports**: Base, Base Sepolia
* **Notes**: Production-ready for mainnet payments with KYT/OFAC compliance checks. Can also be used for testing on Base Sepolia. Requires CDP API keys. Uses facilitator object instead of facilitator URL.
* **Requirements**: CDP account and API keys from [cdp.coinbase.com](https://cdp.coinbase.com), see [Quickstart for Sellers: Running on Mainnet](/x402/quickstart-for-sellers#running-on-mainnet) for more details.

### x402.rs Facilitator

* **Supports**: Base Sepolia, Base, XDC Mainnet
* **Notes**: Rust-based facilitator operated by the x402 community.
* **URL**: [https://facilitator.x402.rs](https://facilitator.x402.rs)

### Self-Hosted Facilitators

* **Supports**: Any EVM network
* **Notes**: Run your own facilitator for full control and customization. Supports networks like Avalanche, Polygon, Arbitrum, and other EVM-compatible chains.
* **Setup**: See "Adding Support for New Networks" section below

### Third-Party Facilitators

Additional facilitators may be available from external providers. Check the [x402 Discord community](https://discord.gg/cdp) for the latest facilitator offerings.

## Token Support

x402 supports any ERC-20 token that implements the EIP-3009 standard.

**Important**: Facilitators support networks, not specific tokens - any EIP-3009 compatible token works on any facilitator.

### EIP-3009 Requirement

Tokens must implement the `transferWithAuthorization` function from the EIP-3009 standard. This enables:

* **Gasless transfers**: The facilitator sponsors gas fees
* **Signature-based authorization**: Users sign transfer authorizations off-chain
* **Secure payments**: Transfers are authorized by cryptographic signatures

### Specifying Payment Amounts

When configuring payment requirements, you have two options:

1. **Price String** (e.g., `"$0.01"`) - The system infers USDC as the token
2. **[TokenAmount](https://github.com/coinbase/x402/blob/094dcd2b95b5e13e8673264cc026d080417ee142/typescript/packages/x402/src/types/shared/middleware.ts#L28)** - Specify exact atomic units of any EIP-3009 token

### Using Custom EIP-3009 Tokens

To use a custom EIP-3009 token, you need three key pieces of information:

1. **Token Address**: The contract address of your EIP-3009 token
2. **EIP-712 Name**: The token's name for EIP-712 signatures
3. **EIP-712 Version**: The token's version for EIP-712 signatures

#### Finding Token Information on Basescan

You can retrieve the required EIP-712 values from any block explorer:

1. **Name**: Read the `name()` function - [Example on Basescan](https://basescan.org/token/0x833589fcd6edb6e08f4c7c32d4f71b54bda02913#readProxyContract#F16)
2. **Version**: Read the `version()` function - [Example on Basescan](https://basescan.org/token/0x833589fcd6edb6e08f4c7c32d4f71b54bda02913#readProxyContract#F24)

These values are used in the `eip712` nested object when configuring TokenAmount:

```typescript
{
  eip712: {
    name: "USD Coin",    // From name() function
    version: "2"         // From version() function
  }
}
```

### USDC - The Default Token

* **Status**: Supported by default across all networks
* **Why**: USDC implements EIP-3009 and is widely available
* **Networks**: Available on Base, Base Sepolia, and all supported networks

### Why EIP-3009?

The EIP-3009 standard is essential for x402 because it enables:

1. **Gas abstraction**: Buyers don't need native tokens (ETH, MATIC, etc.) for gas
2. **One-step payments**: No separate approval transactions required
3. **Universal facilitator support**: Any EIP-3009 token works with any facilitator

## Quick Reference

| Facilitator     | Networks Supported      | Production Ready | Requirements    |
| --------------- | ----------------------- | ---------------- | --------------- |
| x402.org        | base-sepolia            | âŒ Testnet only   | None            |
| CDP Facilitator | base, base-sepolia      | âœ…                | CDP API keys    |
| x402.rs         | base-sepolia, base, xdc | âœ…                | None            |
| Self-hosted     | Any EVM network         | âœ…                | Technical setup |

**Note**: All facilitators support any EIP-3009 compatible token on their supported networks.

## Adding Support for New Networks

There are two ways to add support for new EVM networks in x402:

### Option 1: Contributing to x402 Packages

You can add official network support by submitting a PR to the x402 repository. This makes your network available to all x402 users.

#### Files to Modify

1. **`typescript/packages/x402/src/types/shared/evm/config.ts`**

   Add your network's chain ID and USDC address:

   ```typescript
   // Example: Adding Avalanche networks
   "43113": {  // Avalanche Fuji testnet chain ID
     usdcAddress: "0x5425890298aed601595a70AB815c96711a31Bc65",
     usdcName: "USD Coin",
   },
   "43114": {  // Avalanche mainnet chain ID
     usdcAddress: "0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E",
     usdcName: "USDC",
   },
   ```

2. **`typescript/packages/x402/src/types/shared/network.ts`**

   Add your network to the schema and mappings:

   ```typescript
   // Update the NetworkSchema enum
   export const NetworkSchema = z.enum(["base-sepolia", "base", "avalanche-fuji", "avalanche"]);

   // Add to SupportedEVMNetworks array
   export const SupportedEVMNetworks: Network[] = [
     "base-sepolia",
     "base",
     "avalanche-fuji",
     "avalanche",
   ];

   // Add to EvmNetworkToChainId mapping
   ["avalanche-fuji", 43113],
   ["avalanche", 43114],
   ```

3. **`typescript/packages/x402/src/types/shared/evm/wallet.ts` - Update `getChainFromNetwork` function**

   Add your network to the `getChainFromNetwork` function to map your network string to the viem chain object:

   ```typescript
   import { avalanche, avalancheFuji } from "viem/chains";

   // Add your network to the switch statement in getChainFromNetwork
   case "avalanche":
     return avalanche;
   case "avalanche-fuji":
     return avalancheFuji;
   ```

#### Key Requirements

* **Network key**: Use a consistent network identifier (e.g., `avalanche-fuji`) across all files
* **Viem chain**: Your network must be available in viem/chains or you'll need to define it manually
* **USDC address**: Must be EIP-3009 compatible (has `transferWithAuthorization` function)
* **Chain ID**: Use your network's official chain ID in the config
* **Consistency**: Ensure the network name matches across `NetworkSchema`, `SupportedEVMNetworks`, `EvmNetworkToChainId`, and the `getChainFromNetwork` switch statement

### Option 2: Running Your Own Facilitator

If you need immediate support or want to test before contributing, you can run your own facilitator.

Video Guide: [Adding EVM Chains to x402](https://x.com/jaycoolh/status/1920851551905575164/video/1)

#### Prerequisites

1. Access to an RPC endpoint for your target network
2. A wallet with native tokens for gas sponsorship
3. The x402 facilitator code

## Future Network Support

The x402 ecosystem is actively expanding network support. Planned additions include:

* Additional L2 networks
* Non-EVM chain support (Solana in development)
* Cross-chain payment capabilities

## Getting Help

For help with network integration:

* Join the [x402 Discord community](https://discord.gg/cdp)
* Check the [x402 GitHub repository](https://github.com/coinbase/x402)

## Summary

x402's network support is designed to be extensible while maintaining security and reliability. Whether you're using the default Base Sepolia setup for testing or running your own facilitator for custom networks, the protocol provides flexibility for various use cases.

Key takeaways:

* Base and Base Sepolia have the best out-of-the-box support
* Any EVM network can be supported with a custom facilitator
* Any EIP-3009 token (with `transferWithAuthorization`) works on any facilitator
* Use price strings for USDC or TokenAmount for custom tokens
* Network choice affects gas costs and payment economics

Next, explore:

* [Quickstart for Sellers](/x402/quickstart-for-sellers) â€” Start accepting payments on supported networks
* [Core Concepts](/x402/core-concepts/how-it-works) â€” Learn how x402 works under the hood
* [Facilitator](/x402/core-concepts/facilitator) â€” Understand the role of facilitators
* [MCP Server](/x402/mcp-server) â€” Set up AI agents to use x402 payments



# MCP Server with x402

[Model Context Protocol (MCP)](https://www.modelcontextprotocol.io/) is a protocol for passing context between LLMs and other AI agents. This page shows how to use the x402 payment protocol with MCP to make paid API requests through an MCP server, and how to connect it to Claude Desktop.

## What is this integration?

This guide walks you through running an MCP server that can access paid APIs using the x402 protocol. The MCP server acts as a bridge between Claude Desktop (or any MCP-compatible client) and a paid API (such as the sample weather API in the x402 repo). When Claude (or another agent) calls a tool, the MCP server will:

1. Detect if the API requires payment (via HTTP 402)
2. Automatically handle the payment using your wallet
3. Return the paid data to the client (e.g., Claude)

This lets you (or your agent) access paid APIs programmatically, with no manual payment steps.

## Prerequisites

* Node.js (v20 or higher)
* An x402-compatible server to connect to (for this demo, we'll use the [sample express server with weather data](https://github.com/coinbase/x402/tree/main/examples/typescript/servers/express) from the x402 repo, or any external x402 API)
* An Ethereum wallet with USDC (on Base Sepolia or Base Mainnet)
* [Claude Desktop with MCP support](https://claude.ai/download)

## Step-by-Step: Build the MCP + x402 Integration

You can find a ready-to-use version of this code in the [x402 repo](https://github.com/coinbase/x402/tree/main/examples/typescript/mcp). Below, we explain each step so you understand how it works and can adapt it to your needs.

### 1. Install Dependencies

```bash lines wrap
npm install @modelcontextprotocol/sdk axios viem x402-axios dotenv
```

### 2. Set Up Environment Variables

Create a `.env` file in your project root:

```
PRIVATE_KEY=0xYourTestnetPrivateKey
RESOURCE_SERVER_URL=http://localhost:4021
ENDPOINT_PATH=/weather
```

* `PRIVATE_KEY`: Your EVM wallet's private key (for signing payments)
* `RESOURCE_SERVER_URL`: The base URL of the paid API (use the sample express server for this demo)
* `ENDPOINT_PATH`: The specific endpoint path (e.g., `/weather`)

### 3. Implementation: MCP Server with x402 Payments

```javascript [expandable] lines wrap
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import axios from "axios";
import { Hex } from "viem";
import { privateKeyToAccount } from "viem/accounts";
import { withPaymentInterceptor } from "x402-axios";
import { config } from "dotenv";

// Load environment variables and throw an error if any are missing
config();

const privateKey = process.env.PRIVATE_KEY as Hex;
const baseURL = process.env.RESOURCE_SERVER_URL as string; // e.g. https://example.com
const endpointPath = process.env.ENDPOINT_PATH as string; // e.g. /weather

if (!privateKey || !baseURL || !endpointPath) {
  throw new Error("Missing environment variables");
}

// Create a wallet client to handle payments
const account = privateKeyToAccount(privateKey);

// Create an axios client with payment interceptor using x402-axios
const client = withPaymentInterceptor(axios.create({ baseURL }), account);

// Create an MCP server
const server = new McpServer({
  name: "x402 MCP Client Demo",
  version: "1.0.0",
});

// Add an addition tool
server.tool(
  "get-data-from-resource-server",
  "Get data from the resource server (in this example, the weather)", //change this
  description to change when the client calls the tool
  {},
  async () => {
    const res = await client.get(endpointPath);
    return {
      content: [{ type: "text", text: JSON.stringify(res.data) }],
    };
  },
);

const transport = new StdioServerTransport();
await server.connect(transport);
```

## How it works

* The MCP server exposes a tool that, when called, fetches data from a paid API endpoint.
* If the endpoint requires payment, the x402-axios interceptor handles the payment handshake using your wallet.
* Once payment is complete, the data is returned to the MCP client (e.g., Claude Desktop).

## Add the MCP Server to Claude Desktop

To use this integration with Claude Desktop:

1. Open Claude Desktop and go to MCP settings.
2. Add a new MCP server with the following config (adjust paths as needed):

```json lines wrap
{
  "mcpServers": {
    "demo": {
      "command": "pnpm",
      "args": [
        "--silent",
        "-C",
        "<absolute path to this repo>/examples/typescript/clients/mcp",
        "dev"
      ],
      "env": {
        "PRIVATE_KEY": "<private key of a wallet with USDC on Base Sepolia>",
        "RESOURCE_SERVER_URL": "http://localhost:4021",
        "ENDPOINT_PATH": "/weather"
      }
    }
  }
}
```

3. Make sure your x402-compatible server (e.g., the sample express server) is running and accessible at the URL you provided.
4. Start the MCP client (e.g., with `pnpm dev` in the client directory).
5. Claude can now call the tool and receive paid data!

***

## How the Pieces Fit Together

* **x402-compatible server**: Hosts the paid API (e.g., weather data). Responds with HTTP 402 if payment is required.
* **MCP server (this implementation)**: Acts as a bridge, handling payment and exposing tools to MCP clients.
* **Claude Desktop**: Calls the MCP tool, receives the paid data, and displays it to the user.

## Next Steps

* [See the full example in the repo](https://github.com/coinbase/x402/tree/main/examples/typescript/mcp)
* Try integrating with your own x402-compatible APIs
* Extend the MCP server with more tools or custom logic as needed.



